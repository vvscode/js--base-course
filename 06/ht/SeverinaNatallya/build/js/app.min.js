!function t(e,n,a){function r(o,c){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!c&&u)return u(o,!0);if(i)return i(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var h=n[o]={exports:{}};e[o][0].call(h.exports,function(t){var n=e[o][1][t];return r(n||t)},h,h.exports,t,e,n,a)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<a.length;o++)r(a[o]);return r}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.listeners={}}return a(t,[{key:"trigger",value:function(t,e){var n=arguments;try{(this.listeners[t]||[]).forEach(function(t){"function"==typeof t&&t.apply(null,[].slice.call(n,1))})}catch(t){console.log("ошибка в подписчике: "+t)}}},{key:"on",value:function(t,e){this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)}},{key:"off",value:function(t,e){this.listeners[t]=e?(this.listeners[t]||[]).filter(function(t){return t!==e}):[]}},{key:"once",value:function(t,e){var n=this;this.on(t,function a(){e.apply(null,arguments),n.off(t,a)})}}]),t}();n.default=r},{}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),r=t("./utils"),i=function(){function t(e,n){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.htmlEl=e,this.eventBus=n,this.favoritesList,this.readData().then(function(){return a.render()}).catch(function(t){console.log(t)}),this.addHandlers()}return a(t,[{key:"addHandlers",value:function(){var t=this;this.htmlEl.addEventListener("click",function(e){t.deleteItem(e)}),this.eventBus.on("weatherMap:changeFavorites",function(e){t.addItem(e)})}},{key:"readData",value:function(){var t=this;return r.iStorage.getData("favoritesList").then(function(e){t.favoritesList=e?e.split(","):[]}).catch(function(){console.log("ошибка получения данных")})}},{key:"deleteItem",value:function(t){var e=this;if("btnDelete"==t.target.className){var n=t.target.previousSibling.text;"string"==typeof this.favoritesList&&(this.favoritesList=this.favoritesList.split(","));var a=this.favoritesList.filter(function(t){return t!=n});this.favoritesList=a.join(","),r.iStorage.setData("favoritesList",this.favoritesList).then(function(){e.readData().then(function(){return e.render()}).catch(function(t){console.log(t)})})}}},{key:"addItem",value:function(t){var e=this;this.readData().then(function(){return e.favoritesList.unshift(t),e.favoritesList.join(",")}).then(function(t){r.iStorage.setData("favoritesList",t)}).then(function(){e.readData().then(function(){return e.render()}).catch(function(t){console.log(t)})}).catch(function(){console.log("ошибка добавления избранного")})}},{key:"render",value:function(){var t="<ul>";t+=this.favoritesList.map(function(t,e){return'<li value="'+t+'"><a href="#city='+t+'">'+t+'</a><button class="btnDelete">X</button ></li>'}).join(""),t+="</ul>",this.htmlEl.innerHTML=t}}]),t}();n.default=i},{"./utils":9}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),r=t("./utils"),i=function(){function t(e,n){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.htmlEl=e,this.eventBus=n,this.historyList,this.readData().then(function(){return a.render()}).catch(function(t){console.log(t)}),this.addHandlers()}return a(t,[{key:"addHandlers",value:function(){var t=this;this.eventBus.on("weatherMap:changeHistory",function(e){t.addItem(e)})}},{key:"addItem",value:function(t){var e=this;this.readData().then(function(){return e.historyList.unshift(t),e.historyList.length>5&&e.historyList.pop(),e.historyList.join(",")}).then(function(t){r.iStorage.setData("historyList",t)}).then(function(){e.readData().then(function(){return e.render()}).catch(function(t){console.log(t)})}).catch(function(){console.log("ошибка добавления истории")})}},{key:"readData",value:function(){var t=this;return r.iStorage.getData("historyList").then(function(e){t.historyList=e?e.split(","):[]}).catch(function(){console.log("ошибка получения данных")})}},{key:"render",value:function(){var t="<ul>";t+=this.historyList.map(function(t,e){return'<li value="'+t+'"><a href="#city='+t+'">'+t+"</a></li>"}).join(""),t+="</ul>",this.htmlEl.innerHTML=t}}]),t}();n.default=i},{"./utils":9}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),r=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.routes=e.routes||[],this.prevRoute,this.prevParam,this.activeRoute,this.activeParam,window.addEventListener("hashchange",function(){return n.handleHashChange(window.location.hash)}),this.handleHashChange(window.location.hash)}return a(t,[{key:"handleHashChange",value:function(t){var e=this;t=t.slice(1),this.routes.forEach(function(n,a,r){"string"==typeof n.match&&n.match===t?e.activeRoute=n:"function"==typeof n.match&&n.match(t)?e.activeRoute=n:n.match instanceof RegExp&&n.match.test(t)&&(e.activeRoute=n)}),this.activeParam=this.getParams(t),this.execFunctions()}},{key:"getParams",value:function(t){var e=t.match(this.activeRoute.match)||[];return 2==e.length?e[1]:e}},{key:"execFunctions",value:function(){var t=this;Promise.resolve().then(function(){t.prevRoute&&t.prevRoute.onLeave&&t.prevRoute.onLeave(t.prevParam)}).then(function(){t.activeRoute&&t.activeRoute.onBeforeEnter&&t.activeRoute.onBeforeEnter(t.activeParam)}).then(function(){t.activeRoute&&t.activeRoute.onEnter&&t.activeRoute.onEnter(t.activeParam)}).then(function(){t.prevRoute=t.activeRoute,t.prevParam=t.activeParam}).catch(function(){return alert("маршрут отсутствует")})}}]),t}();n.default=r},{}],5:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),r=function(){function t(e,n){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.htmlEl=e,this.eventBus=n,this.eventBus.on("weatherMap:changeForecast",function(t){return a.render(t)})}return a(t,[{key:"render",value:function(t){this.htmlEl.innerHTML=t}}]),t}();n.default=r},{}],6:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),r=t("./utils"),i=t("./services"),o=function(){function t(e,n,a){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map,this.center=e,this.eventBus=n,this.ymaps=a,this.ymaps.ready(function(){return r.drawMap()})}return a(t,[{key:"drawMap",value:function(){this.map=new this.ymaps.Map("myMap",{center:this.center,controls:["zoomControl"],zoom:10});var t=new this.ymaps.control.Button({data:{image:"https://rawgit.com/NatallyaSeverina/js--base-course/06ht/06/ht/SeverinaNatallya/build/img/favorites.png"},options:{float:"right"}});this.map.controls.add(t),this.addHandlers(t)}},{key:"addHandlers",value:function(t){var e=this;t.events.add("click",function(t){e.center=e.map.getCenter(),e.eventBus.trigger("weatherMap:add2Favorite",e.center)}),this.map.events.add("boundschange",(0,r.debounce)(function(t){e.eventBus.trigger("weatherMap:centerChange",t.get("newCenter")),(0,i.changeHashByMapState)(t.get("newCenter"))},2e3)),this.eventBus.on("weatherMap:setMapCenter",function(t){e.center=t,e.render()})}},{key:"render",value:function(){this.map.panTo(this.center,{duration:2e3})}}]),t}();n.default=o},{"./services":8,"./utils":9}],7:[function(t,e,n){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],a=!0,r=!1,i=void 0;try{for(var o,c=t[Symbol.iterator]();!(a=(o=c.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{!a&&c.return&&c.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=t("./services"),o=a(t("./EventBus")),c=a(t("./Router")),u=a(t("./WeatherForecast")),s=a(t("./RequestHistory")),h=a(t("./FavoriteList")),l=a(t("./YandexMap")),f=new o.default,d=document.forms.main;d.addEventListener("submit",function(t){t.preventDefault(),(0,i.changeMapStateByCityName)(d,f,d.search.value)}),new u.default(document.getElementsByClassName("weather")[0],f),new s.default(document.getElementsByClassName("history")[0],f),new h.default(document.getElementsByClassName("favorites")[0],f),(0,i.getMapCenterFromHash)(d.rb.value).then(function(t){new l.default(t,f,ymaps),f.trigger("weatherMap:centerChange",t)}).catch(function(t){f.trigger("weatherMap:changeForecast","ошибка получения прогноза")}),f.on("weatherMap:centerChange",function(t){var e=r(t,2),n=e[0],a=e[1],o=void 0;("fetch"==d.rb.value?(0,i.getForecastByCoordFetch)({lat:n,lng:a}):(0,i.getForecastByCoordXHR)({lat:n,lng:a})).then(function(t){var e=t.temp,n=t.descript,a=t.humidity,r=t.windSpeed;o="<h2>В ближайшие 3 часа ожидается:<br/>температура "+e+" C<br/>влажность "+a+"%<br/>скорость ветра "+r+" м/с<br/>"+n+"</h2>",f.trigger("weatherMap:changeForecast",o)}).catch(function(t){f.trigger("weatherMap:changeForecast","ошибка получения прогноза")})}),f.on("weatherMap:add2Favorite",function(t){var e=t[0],n=t[1];"fetch"==d.rb.value?(0,i.getCityNameByCoordFetch)({lat:e,lng:n}).then(function(t){f.trigger("weatherMap:changeFavorites",t)}):(0,i.getCityNameByCoordXHR)({lat:e,lng:n}).then(function(t){f.trigger("weatherMap:changeFavorites",t)})});new c.default({routes:[{name:"index",match:"",onEnter:function(){}},{name:"about",match:"about",onEnter:function(){document.getElementById("about").hidden=!1},onLeave:function(){document.getElementById("about").hidden=!0}},{name:"main",match:/city=(.+)/i,onEnter:function(t){(0,i.changeMapStateByCityName)(d,f,t)}},{name:"map",match:/center=(-?\d*[.]?\d+,-?\d*[.]?\d+)/,onEnter:function(t){}},{name:"author",match:"author",onEnter:function(){document.getElementById("author").hidden=!1},onLeave:function(){document.getElementById("author").hidden=!0}}]})},{"./EventBus":1,"./FavoriteList":2,"./RequestHistory":3,"./Router":4,"./WeatherForecast":5,"./YandexMap":6,"./services":8}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){return fetch("https://api.userinfo.io/userinfos").then(function(t){return t.json()}).then(function(t){return{lat:t.position.latitude,lng:t.position.longitude}}).catch(function(){alert("Ошибка запроса")})},r=function(t){return fetch("https://api.openweathermap.org/data/2.5/forecast?q="+t+"&units=metric&lang=ru&APPID=97248aca315ea6cccb5cf1cab8b0771b").then(function(t){return t.json()}).then(function(t){return{temp:t.list[0].main.temp_max,descript:t.list[0].weather[0].description,humidity:t.list[0].main.humidity,windSpeed:t.list[0].wind.speed,lat:t.city.coord.lat,lng:t.city.coord.lon}}).catch(function(){alert("Ошибка запроса, проверьте название нас.пункта")})},i=function(){return new Promise(function(t,e){var n=new XMLHttpRequest;n.open("GET","https://api.userinfo.io/userinfos",!0),n.send(),n.onreadystatechange=function(){if(4==n.readyState)if(200!=n.status)alert("ошибка: "+(n.status?n.statusText:"запрос не удался")),e();else{var a=JSON.parse(n.response);t({lat:a.position.latitude,lng:a.position.longitude})}}})},o=function(t){return new Promise(function(e,n){var a=new XMLHttpRequest;a.open("GET","https://api.openweathermap.org/data/2.5/forecast?q="+t+"&units=metric&lang=ru&APPID=97248aca315ea6cccb5cf1cab8b0771b",!0),a.send(),a.onreadystatechange=function(){if(4==a.readyState)if(200!=a.status)alert("ошибка: "+(a.status?a.statusText:"запрос не удался, проверьте название нас.пункта")),n();else{var t=JSON.parse(a.response);e({temp:t.list[0].main.temp_max,descript:t.list[0].weather[0].description,humidity:t.list[0].main.humidity,windSpeed:t.list[0].wind.speed,lat:t.city.coord.lat,lng:t.city.coord.lon})}}})};n.changeHashByMapState=function(t){window.location.hash="center="+t},n.getMapCenterFromHash=function(t){return new Promise(function(e,n){var r=window.location.hash.match(/#center=(-?\d*[.]?\d+),(-?\d*[.]?\d+)/),o=void 0;r?(o=[+r[1],+r[2]],e(o)):"XHR"==t?i().then(function(t){var n=t.lat,a=t.lng;e(o=[+n,+a])}):a().then(function(t){var n=t.lat,a=t.lng;e(o=[+n,+a])})})},n.getUserInfoFetch=a,n.getCityNameByCoordFetch=function(t){var e=t.lat,n=t.lng;return fetch("https://api.openweathermap.org/data/2.5/forecast?lat="+e+"&lon="+n+"&units=metric&lang=ru&APPID=97248aca315ea6cccb5cf1cab8b0771b").then(function(t){return t.json()}).then(function(t){return t.city.name}).catch(function(){alert("Ошибка запроса")})},n.getForecastByCoordFetch=function(t){var e=t.lat,n=t.lng;return fetch("https://api.openweathermap.org/data/2.5/forecast?lat="+e+"&lon="+n+"&units=metric&lang=ru&APPID=97248aca315ea6cccb5cf1cab8b0771b").then(function(t){return t.json()}).then(function(t){return{temp:t.list[0].main.temp_max,descript:t.list[0].weather[0].description,humidity:t.list[0].main.humidity,windSpeed:t.list[0].wind.speed}}).catch(function(){alert("Ошибка запроса")})},n.getForecastByCityNameFetch=r,n.getUserInfoXHR=i,n.getCityNameByCoordXHR=function(t){var e=t.lat,n=t.lng;return new Promise(function(t,a){var r=new XMLHttpRequest;r.open("GET","https://api.openweathermap.org/data/2.5/forecast?lat="+e+"&lon="+n+"&units=metric&lang=ru&APPID=97248aca315ea6cccb5cf1cab8b0771b",!0),r.send(),r.onreadystatechange=function(){if(4==r.readyState)if(200!=r.status)alert("ошибка: "+(r.status?r.statusText:"запрос не удался")),a();else{var e=JSON.parse(r.response);t(e.city.name)}}})},n.getForecastByCoordXHR=function(t){var e=t.lat,n=t.lng;return new Promise(function(t,a){var r=new XMLHttpRequest;r.open("GET","https://api.openweathermap.org/data/2.5/forecast?lat="+e+"&lon="+n+"&units=metric&lang=ru&APPID=97248aca315ea6cccb5cf1cab8b0771b",!0),r.send(),r.onreadystatechange=function(){if(4==r.readyState)if(200!=r.status)alert("ошибка: "+(r.status?r.statusText:"запрос не удался")),a();else{var e=JSON.parse(r.response);t({temp:e.list[0].main.temp_max,descript:e.list[0].weather[0].description,humidity:e.list[0].main.humidity,windSpeed:e.list[0].wind.speed})}}})},n.getForecastByCityNameXHR=o,n.changeMapStateByCityName=function(t,e,n){var a=void 0;"fetch"==t.rb.value?r(n).then(function(t){var r=t.temp,i=t.descript,o=t.humidity,c=t.windSpeed,u=t.lat,s=t.lng;a="<h2>В ближайшие 3 часа ожидается:<br/>температура "+r+" C<br/>влажность "+o+"%<br/>скорость ветра "+c+" м/с<br/>"+i+"</h2>",e.trigger("weatherMap:changeForecast",a),e.trigger("weatherMap:setMapCenter",[+u,+s]),e.trigger("weatherMap:changeHistory",n)}).catch(function(t){e.trigger("weatherMap:changeForecast","ошибка получения прогноза")}):o(n).then(function(t){var r=t.temp,i=t.descript,o=t.humidity,c=t.windSpeed,u=t.lat,s=t.lng;a="<h2>В ближайшие 3 часа ожидается:<br/>температура "+r+" C<br/>влажность "+o+"%<br/>скорость ветра "+c+" м/с<br/>"+i+"</h2>",e.trigger("weatherMap:changeForecast",a),e.trigger("weatherMap:setMapCenter",[+u,+s]),e.trigger("weatherMap:changeHistory",n)}).catch(function(t){e.trigger("weatherMap:changeForecast","ошибка получения прогноза")})}},{}],9:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={setData:function(t,e){return new Promise(function(n,a){window.localStorage.setItem(t,e),n([t,e])})},getData:function(t){return Promise.resolve(window.localStorage.getItem(t))}};n.debounce=function(t,e){function n(){if(i)return a=arguments,void(r=this);t.apply(this,arguments),i=1,setTimeout(function(){i=0,r&&(n.apply(r,a),a=r=null)},e)}var a,r,i=0;return n},n.iStorage=a},{}]},{},[7]);
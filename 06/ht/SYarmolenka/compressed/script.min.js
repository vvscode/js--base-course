!function e(t,n,o){function r(i,s){if(!n[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[i]={exports:{}};t[i][0].call(d.exports,function(e){var n=t[i][1][e];return r(n||e)},d,d.exports,e,t,n,o)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.addCityInHistory=void 0;var o=e("./request"),r=document.querySelector("#history"),a=document.querySelector("#favorite"),i=window.sessionStorage.getItem("history"),s=window.localStorage.getItem("favorite");function c(e){if(e.length>5){var t=e[e.length-1];t.parentNode.removeChild(t)}}r.innerHTML=null!==i?i:"История поиска:",a.innerHTML=null!==s?s:"Избранное:",document.body.addEventListener("click",function(e){var t,n;e.target.closest("#star")&&(e.preventDefault(),stage.city&&"None"!==stage.city&&(!function(e){var t=document.querySelectorAll(".favorite");if(t.length>0){t.findIndex=[].findIndex;var n=t.findIndex(function(t){var n=t.innerHTML.match(/<span>(.+?)<\/span>/)[1];if(n===e)return 1});-1!==n&&t[n].parentNode.removeChild(t[n])}}(stage.city),t=stage.city,(n=document.createElement("div")).classList.add("favorite"),n.innerHTML="<span>"+t+'</span> <button class="close">&#215;</button>',a.insertBefore(n,a.firstElementChild),window.localStorage.setItem("favorite",a.innerHTML),c(document.querySelectorAll(".favorite"))))}),document.body.addEventListener("click",function(e){if(e.target.matches(".close")){e.preventDefault();var t=e.target.parentNode;t.parentNode.removeChild(t),window.localStorage.setItem("favorite",a.innerHTML)}}),document.body.addEventListener("click",function(e){e.target.closest(".favorite")&&!e.target.matches(".close")&&(e.preventDefault(),(0,o.requestCoords)(e.target.closest(".favorite").innerHTML.match(/<span>(.+?)<\/span>/)[1])),e.target.matches(".history")&&(e.preventDefault(),(0,o.requestCoords)(e.target.innerText))}),n.addCityInHistory=function(e){var t=document.querySelectorAll(".history"),n=document.createElement("div");if(t.length>0){t.findIndex=[].findIndex;var o=t.findIndex(function(t){if(t.innerText===e)return 1});-1!==o&&t[o].parentNode.removeChild(t[o])}n.classList.add("history"),n.innerText=e,r.insertBefore(n,r.firstElementChild),c(document.querySelectorAll(".history")),window.sessionStorage.setItem("history",r.innerHTML)}},{"./request":3}],2:[function(e,t,n){"use strict";function o(){this.event={}}Object.defineProperty(n,"__esModule",{value:!0}),o.prototype.on=function(e,t){e in this.event?this.event[e].push(t):this.event[e]=[t]},o.prototype.off=function(e,t){if(this.event[e]){if(t){var n=void 0;return this.event[e].forEach(function(e,o){e===t&&(n=o)}),void this.event[e].splice(n,1)}delete this.event[e]}},o.prototype.trigger=function(e){if(e in this.event){var t=arguments;this.event[e].forEach(function(e){t.slice=[].slice,e.apply(this,t.slice(1))})}},o.prototype.once=function(e,t){var n=this;this.on(e,function o(){t.apply(this,arguments),n.off(e,o)})};var r=new o;n.newEb=r},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.requestCityName=n.requestWeather=n.requestCoords=void 0;var o=e("./observer"),r=e("./script"),a=e("./local"),i=document.querySelectorAll(".http");function s(){i.forEach(function(e){e.checked&&(stage.request=e.value)})}function c(){"XHR"===stage.request&&function(e,t){var n=new XMLHttpRequest,r=e;n.open("GET",r,!0),n.onload=function(){o.newEb.trigger(t,this.responseText)},n.onerror=function(){alert("Ошибка "+this.status)},n.send()}.apply(this,arguments),"fetch"===stage.request&&function(e,t){fetch(e,{method:"GET"}).then(function(e){return e.text()},function(e){alert("Ошибка "+e.status)}).then(function(e){o.newEb.trigger(t,e)})}.apply(this,arguments)}s(),document.body.addEventListener("change",function(e){e.target.matches(".http")&&s()}),o.newEb.on("weather",function(e){var t=JSON.parse(e),n=t.hourly.data.findIndex(function(e){return e.time>=Date.now()/1e3});n=n?--n:n;var o=t.hourly.data[n];document.querySelector("#weather").children[1].innerText="Погода:\n"+o.summary+"\nТемпература: "+o.apparentTemperature+"°С\nВлажность: "+100*o.humidity+"%\nВетер: "+o.windSpeed+"м/с\nДавление: "+100*o.pressure+"Па"}),o.newEb.on("city",function(e){var t=JSON.parse(e);stage.city="OK"!==t.status?"None":t.results[0].address_components[0].long_name,document.querySelector("#weather").children[0].innerText="Населенный пункт: "+stage.city+"\n"}),o.newEb.on("coords",function(e){var t=JSON.parse(e);if("OK"!==t.status)return;stage.coords=[t.results[0].geometry.location.lat,t.results[0].geometry.location.lng],stage.city=t.results[0].address_components[0].long_name,(0,r.refreshCoords)(),(0,a.addCityInHistory)(stage.city)}),n.requestCoords=function(e){c("https://maps.googleapis.com/maps/api/geocode/json?address="+e+"&key=AIzaSyBFl2Chh3nLWZ-bVlsSPiH_Q1o7f1x6cpg","coords")},n.requestWeather=function(){c("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/0fbec31d64e8fba6637a108f151904ad/"+stage.coords[0]+","+stage.coords[1]+"?lang=ru&units=si","weather")},n.requestCityName=function(){c("https://maps.googleapis.com/maps/api/geocode/json?latlng="+(stage.coords[0]+.001)+","+(stage.coords[1]+.001)+"&result_type=locality&key=AIzaSyBFl2Chh3nLWZ-bVlsSPiH_Q1o7f1x6cpg","city")}},{"./local":1,"./observer":2,"./script":5}],4:[function(e,t,n){"use strict";var o=e("./request"),r=e("./script");document.body.addEventListener("click",function(e){e.target.matches(".route")&&(e.preventDefault(),"Main"!==e.target.innerText?window.location.hash=e.target.innerText:window.location.hash="")});var a={routes:[],interpret:function(e){var t=void 0;return this.routes.forEach(function(n){"string"==typeof n.match&&n.match===e&&(t=n),"object"==typeof n.match&&n.match instanceof RegExp&&null!==e.match(n.match)&&(n.param=e.match(n.match),t=n),"function"==typeof n.match&&n.match(e)&&(a.param=e,t=n)}),t},start:function(){window.addEventListener("hashchange",function(e){var t=e.oldURL.match(/#(.+)/),n=e.newURL.match(/#(.+)/);t=null!==t?t[1]:"",n=null!==n?n[1]:"",a.change(t,n)}),this.change("",window.location.hash.slice(1))},change:function(e,t){var n=a.interpret(e);return n?("function"==typeof n.onLeave&&Promise.resolve(n.param).then(n.onLeave),(n=a.interpret(t))?("function"==typeof n.onEnter&&Promise.resolve(n.param).then(n.onEnter),void("function"==typeof n.onBefore&&Promise.resolve(n.param).then(n.onBefore))):console.error("interpret(newHash) не нашёл route!")):console.error("interpret(oldHash) не нашёл route!")}},i=document.querySelectorAll(".hide"),s=document.querySelector(".about"),c=document.querySelector(".author");a.routes=[{name:"about",match:"About",onEnter:function(){s.innerText='\n        Данное веб-приложение поможет вам узнать погоду в любом месте и по всему миру.\n\n        В верхней части вы увидите кнопки перехода по приложению (About, Main, Author), переключатель режима HTTP-запроса (с помощью объекта XMLHttpRequest или метода fetch) и окно поиска объектов на карте.\n        В центральной части отображается Яндекс карта. Перемещение по карте производится с помощью мыши с зажатой левой кнопкой, зумирование - колесо мыши или палзунок в левой части экрана. Кнопка "звездочка" - добавляет населенный пункт в блок "избранное".\n        В нижней части приложения вы увидите три блока - "история поиска", прогноз погоды и "избранное". Блок "история поиска" отображает список последних пяти найденных населенных пунктов. Блок прогноза погоды отображает населенный пункт, расположенный в центре карты и текущую погоду этого населенного пунка. Блок "избранное" отображает населенные пункты, отмеченные пользователем.\n        Также поддерживается поиск города через url, для этого необходимо в конце url добавить строку "#city(любой символ)название_города", для примера "#city&Minsk". Это сработает аналогичным образом, как и через окно поиска объектов на карте.\n\n        Спасибо компаниям Yandex и Google за предоставление API maps и данных геолокации, а также сайту darksky.net за предоставление данных прогноза погоды.\n      '},onLeave:function(){s.innerHTML=""}},{name:"author",match:"Author",onEnter:function(){c.innerHTML='\n        <span>Автор: Сергей Ермоленко</span>\n        <img src="other/ava.jpg" alt="">\n        <ul>\n          <li>\n            <a href="https://github.com/SYarmolenka" class="gh"></a>\n          </li>\n          <li>\n            <a href="https://www.facebook.com/jibickih" class="fb"></a>\n          </li>\n          <li>\n            <a href="https://vvscode.slack.com/messages/D7YRE6JV9/" class="sl"></a>\n          </li>\n        </ul>\n      '},onLeave:function(){c.innerHTML=""}},{name:"cityName",match:/city\W(\b\w+\b)/,onEnter:function(e){(0,o.requestCoords)(e[1])}},{name:"main",match:/(-?\d+.?\d*),(-?\d+.?\d*)&zoom=(\d+)/,onEnter:function(e){stage.coords=[+e[1],+e[2]],stage.zoom=+e[3],i.forEach(function(e){e.classList.remove("hide")}),myMap?(0,r.refreshMap)():ymaps.ready(r.init).then(function(){(0,o.requestWeather)(),(0,o.requestCityName)()})},onLeave:function(){i.forEach(function(e){e.classList.add("hide")})}},{name:"index",match:function(e){return""===e},onEnter:function(){fetch("https://api.userinfo.io/userinfos",{method:"GET"}).then(function(e){return e.text()},function(e){alert("Ошибка "+e.status)}).then(function(e){var t=JSON.parse(e);stage.coords=[t.position.latitude,t.position.longitude],stage.zoom=10,(0,r.refreshCoords)()})}}],a.start()},{"./request":3,"./script":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.init=n.refreshCoords=n.refreshMap=void 0;var o=e("./request");function r(){window.location.hash=stage.coords[0]+","+stage.coords[1]+"&zoom="+stage.zoom}document.body.addEventListener("keypress",function(e){13==e.keyCode&&e.target.matches("#search>input")&&((0,o.requestCoords)(e.target.value),e.target.value="")}),document.body.addEventListener("click",function(e){e.target.matches("#button")&&(e.preventDefault(),(0,o.requestCoords)(e.target.previousElementSibling.value),e.target.previousElementSibling.value="")}),n.refreshMap=function(){var e,t;e=stage.zoom,t=stage.coords,myMap.setCenter(t,e),(0,o.requestWeather)(),(0,o.requestCityName)()},n.refreshCoords=r,n.init=function(){myMap=new ymaps.Map("map",{center:stage.coords,zoom:stage.zoom,controls:["zoomControl"]}),myMap.events.add("actionend",function(){Promise.resolve().then(function(){stage.coords=myMap.getCenter(),stage.zoom=myMap.getZoom()}).then(r)})}},{"./request":3}]},{},[1,2,3,4,5]);
"use strict";function Calendar(e){var t=e.el,n=e.showControls,a=e.allowAddEvents,r=e.allowRemoveEvents,l=e.className,s=e.title;this.el=t,this.showControls=n,this.allowAddEvents=a,this.allowRemoveEvents=r,this.className=l,this.title=s,this.id=this.el.substring(1),this.run=function(){function e(){var e=localStorage.getItem("calendarData");e=JSON.parse(e),e&&(m=Object.assign({},e),e[u.id]&&(v=e[u.id]))}function t(){var e=document.createElement("h2");e.innerText=u.title;var t=document.createElement("span");t.className="btn-control btn-back",t.innerText="<";var n=document.createElement("span");n.className="btn-control btn-forward",n.innerText=">";var a=document.createElement("span");a.className="date",a.innerHTML=c.getFullYear()+"/"+(c.getMonth()+1);var r=document.createElement("div");r.className="calendar-head",r.appendChild(e);var l=document.createElement("div");u.showControls?l.append(t,a,n):l.append(a),r.append(l),h.appendChild(r)}function n(e){if("btn-control"===e.target.classList[0]){var t;t="btn-forward"===e.target.classList[1]?1:-1,c=new Date(c.setMonth(c.getMonth()+t));var n=h.querySelector("table");n.parentNode.removeChild(n),a()}}function a(){var e=h.querySelector(".date");e.innerHTML=c.getFullYear()+"/"+(c.getMonth()+1);var t=document.createElement("table");t.className="table table-bordered",t.innerHTML="<tbody><tr></tr></tbody>";var n=document.createElement("thead");n.innerHTML;for(var a=document.createElement("tr"),l=["mon","tue","wed","thu","fri","sat","sun"],s=0;s<l.length;s++){var o=document.createElement("th");o.innerHTML=l[s],a.appendChild(o)}n.insertBefore(a,n.childNodes[0]),t.insertBefore(n,t.childNodes[0]);var i=new Date(c.getFullYear(),c.getMonth(),1).getDay();0===i&&(i=7);for(var d=t.querySelector("tbody"),m=1;m<=new Date(c.getFullYear(),c.getMonth()+1,0).getDate();){if(a=t.querySelectorAll("tr"),1===m)for(var s=m;s<i;s++)a[a.length-1].innerHTML+="<td></td>";var v=document.createElement("td");v.innerHTML=m,v.className=1===String(m).length?"0"+m:m,a[a.length-1].appendChild(v),a[a.length-1].childElementCount>6&&(d.innerHTML+="<tr></tr>"),m++}h.appendChild(t),r()}function r(){for(var e in v)if(e.substring(0,8)===c.toISOString().substring(0,8)){var t=h.getElementsByClassName(""+String(e.substring(8,10)));v[e].map(function(e){l(t[0],e)})}}function l(e,t){var n=document.createElement("div");n.className="event "+e.className,n.innerHTML=t+'<span class="delete">x</span>',e.appendChild(n)}function s(){if("td"===event.target.tagName.toLowerCase()){var e=prompt("What will you do?","Go for a walk");e&&(l(event.target,e),o(event,e))}}function o(e,t){var n=c.toISOString().substring(0,8)+e.target.className;if(v[n])v[n].push(t);else{var a=[];a.push(t),v[n]=a}m[u.id]=v,localStorage.setItem("calendarData",JSON.stringify(m))}function i(){"delete"===event.target.className&&(event.target.parentNode.remove(),d(event))}function d(e){var t=c.toISOString().substring(0,8)+e.target.parentNode.classList[1],n=e.target.parentNode.innerText.slice(0,-1),a=v[t].indexOf(n);v[t].splice(a,1),0===v[t].length&&delete v[t],m[u.id]=v,localStorage.setItem("calendarData",JSON.stringify(m))}var c=new Date,m={},v={},u=this,g=document.getElementById(u.id),h=document.createElement("div");h.className="my-calendar "+u.className,g.appendChild(h),e(),t(),a(),console.error(JSON.parse(localStorage.getItem("calendarData"))),u.allowAddEvents&&h.addEventListener("dblclick",s),u.allowRemoveEvents&&h.addEventListener("click",i),h.addEventListener("click",n)}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiQ2FsZW5kYXIiLCJjb25maWciLCJlbCIsInNob3dDb250cm9scyIsImFsbG93QWRkRXZlbnRzIiwiYWxsb3dSZW1vdmVFdmVudHMiLCJjbGFzc05hbWUiLCJ0aXRsZSIsInRoaXMiLCJpZCIsInN1YnN0cmluZyIsInJ1biIsImxvYWRFdmVudHMiLCJjYWxlbmRhckRhdGEiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiSlNPTiIsInBhcnNlIiwiZXZlbnRzQWxsIiwiT2JqZWN0IiwiYXNzaWduIiwic2VsZiIsImV2ZW50cyIsInJlbmRlckhlYWQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lclRleHQiLCJsZWZ0QXJyb3ciLCJyaWdodEFycm93IiwiZGF0ZSIsImlubmVySFRNTCIsImN1cnJlbnREYXRlIiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsImhlYWREaXYiLCJhcHBlbmRDaGlsZCIsInJvdzIiLCJhcHBlbmQiLCJjYWxlbmRhckRpdiIsImhhbmRsZUJ1dHRvbiIsImV2ZW50IiwidGFyZ2V0IiwiY2xhc3NMaXN0IiwibnVtIiwiRGF0ZSIsInNldE1vbnRoIiwiZGVsZXRlMSIsInF1ZXJ5U2VsZWN0b3IiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJyZW5kZXJDYWxlbmRhciIsInRhYmxlIiwidGhlYWQiLCJ0ciIsInRoTmFtZSIsImkiLCJsZW5ndGgiLCJ0aCIsImluc2VydEJlZm9yZSIsImNoaWxkTm9kZXMiLCJmaXJzdERheSIsImdldERheSIsInRib2R5IiwiZGF5IiwiZ2V0RGF0ZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ0ZCIsIlN0cmluZyIsImNoaWxkRWxlbWVudENvdW50IiwicmVuZGVyRXZlbnRzIiwiZXZlbnREYXRlIiwidG9JU09TdHJpbmciLCJldmVudERheSIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJtYXAiLCJpdGVtIiwicmVuZGVyRXZlbnQiLCJ3aGVyZSIsInRleHQiLCJkaXYiLCJhZGRVc2VyRXZlbnQiLCJ0YWdOYW1lIiwidG9Mb3dlckNhc2UiLCJwcm9tcHQiLCJzYXZlRXZlbnRUb0xvY2FsU3RvcmFnZSIsInNhdmVEYXRlIiwicHVzaCIsImFyciIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJkZWxldGVVc2VyRXZlbnQiLCJyZW1vdmUiLCJkZWxldGVFdmVudEZyb21Mb2NhbFN0b3JhZ2UiLCJkZWxldGVEYXRlIiwic2xpY2UiLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJtYWluRGl2IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25zb2xlIiwiZXJyb3IiLCJhZGRFdmVudExpc3RlbmVyIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFBLFNBQVNBLFVBQVNDLEdBQVEsR0FDaEJDLEdBQTBFRCxFQUExRUMsR0FBSUMsRUFBc0VGLEVBQXRFRSxhQUFjQyxFQUF3REgsRUFBeERHLGVBQWdCQyxFQUF3Q0osRUFBeENJLGtCQUFtQkMsRUFBcUJMLEVBQXJCSyxVQUFXQyxFQUFVTixFQUFWTSxLQUV4RUMsTUFBS04sR0FBS0EsRUFDVk0sS0FBS0wsYUFBZUEsRUFDcEJLLEtBQUtKLGVBQWlCQSxFQUN0QkksS0FBS0gsa0JBQW9CQSxFQUN6QkcsS0FBS0YsVUFBWUEsRUFDakJFLEtBQUtELE1BQVFBLEVBRWJDLEtBQUtDLEdBQUtELEtBQUtOLEdBQUdRLFVBQVUsR0FFNUJGLEtBQUtHLElBQU0sV0FnQ1QsUUFBU0MsS0FDUCxHQUFJQyxHQUFlQyxhQUFhQyxRQUFRLGVBQ3hDRixHQUFlRyxLQUFLQyxNQUFNSixHQUN2QkEsSUFDREssRUFBWUMsT0FBT0MsVUFBWVAsR0FFNUJBLEVBQWFRLEVBQUtaLE1BQ25CYSxFQUFTVCxFQUFhUSxFQUFLWixNQUtqQyxRQUFTYyxLQUNQLEdBQUloQixHQUFRaUIsU0FBU0MsY0FBYyxLQUNuQ2xCLEdBQU1tQixVQUFZTCxFQUFLZCxLQUV2QixJQUFJb0IsR0FBWUgsU0FBU0MsY0FBYyxPQUN2Q0UsR0FBVXJCLFVBQVksdUJBQ3RCcUIsRUFB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Y0FBcUJsQyxHQUFPdUUsR0FFbkQzRSxFQUFVRyxFQUFLWixJQUFNYSxFQUVyQlIsYUFBYTBFLFFBQVEsZUFBZ0J4RSxLQUFLeUUsVUFBVXZFLElBNU10RCxHQUFJYSxHQUFjLEdBQUlhLE1BRWxCMUIsS0FDQUksS0FFQUQsRUFBT2IsS0FFUDBGLEVBQVUxRSxTQUFTMkUsZUFBZTlFLEVBQUtaLElBRXZDNkIsRUFBY2QsU0FBU0MsY0FBYyxNQUN6Q2EsR0FBWWhDLFVBQVksZUFBaUJlLEVBQUtmLFVBRTlDNEYsRUFBUS9ELFlBQVlHLEdBR3BCMUIsSUFFQVcsSUFDQTJCLElBRUFrRCxRQUFRQyxNQUFNckYsS0FBS0MsTUFBT0gsYUFBYUMsUUFBUSxrQkFFNUNNLEVBQUtqQixnQkFDTmtDLEVBQVlnRSxpQkFBaUIsV0FBWXRCLEdBRXhDM0QsRUFBS2hCLG1CQUNOaUMsRUFBWWdFLGlCQUFpQixRQUFTWixHQUd4Q3BELEVBQVlnRSxpQkFBaUIsUUFBUy9EIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBDYWxlbmRhcihjb25maWcpIHtcclxuICBjb25zdCB7IGVsLCBzaG93Q29udHJvbHMsIGFsbG93QWRkRXZlbnRzLCBhbGxvd1JlbW92ZUV2ZW50cywgY2xhc3NOYW1lLCB0aXRsZSB9ID0gY29uZmlnO1xyXG5cclxuICB0aGlzLmVsID0gZWw7XHJcbiAgdGhpcy5zaG93Q29udHJvbHMgPSBzaG93Q29udHJvbHM7XHJcbiAgdGhpcy5hbGxvd0FkZEV2ZW50cyA9IGFsbG93QWRkRXZlbnRzO1xyXG4gIHRoaXMuYWxsb3dSZW1vdmVFdmVudHMgPSBhbGxvd1JlbW92ZUV2ZW50cztcclxuICB0aGlzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcclxuICB0aGlzLnRpdGxlID0gdGl0bGU7XHJcblxyXG4gIHRoaXMuaWQgPSB0aGlzLmVsLnN1YnN0cmluZygxKTtcclxuXHJcbiAgdGhpcy5ydW4gPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XHJcblxyXG4gICAgdmFyIGV2ZW50c0FsbCA9IHt9O1xyXG4gICAgdmFyIGV2ZW50cyA9IHt9O1xyXG5cclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICB2YXIgbWFpbkRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGYuaWQpO1xyXG5cclxuICAgIHZhciBjYWxlbmRhckRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgY2FsZW5kYXJEaXYuY2xhc3NOYW1lID0gJ215LWNhbGVuZGFyICcgKyBzZWxmLmNsYXNzTmFtZTtcclxuXHJcbiAgICBtYWluRGl2LmFwcGVuZENoaWxkKGNhbGVuZGFyRGl2KTtcclxuXHJcblxyXG4gICAgbG9hZEV2ZW50cygpO1xyXG5cclxuICAgIHJlbmRlckhlYWQoKTtcclxuICAgIHJlbmRlckNhbGVuZGFyKCk7XHJcblxyXG4gICAgY29uc29sZS5lcnJvcihKU09OLnBhcnNlKCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2FsZW5kYXJEYXRhJykgKSk7XHJcblxyXG4gICAgaWYoc2VsZi5hbGxvd0FkZEV2ZW50cykge1xyXG4gICAgICBjYWxlbmRhckRpdi5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIGFkZFVzZXJFdmVudCk7XHJcbiAgICB9XHJcbiAgICBpZihzZWxmLmFsbG93UmVtb3ZlRXZlbnRzKSB7XHJcbiAgICAgIGNhbGVuZGFyRGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZGVsZXRlVXNlckV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBjYWxlbmRhckRpdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUJ1dHRvbik7XHJcblxyXG4gICAgZnVuY3Rpb24gbG9hZEV2ZW50cygpIHtcclxuICAgICAgdmFyIGNhbGVuZGFyRGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjYWxlbmRhckRhdGEnKTtcclxuICAgICAgY2FsZW5kYXJEYXRhID0gSlNPTi5wYXJzZShjYWxlbmRhckRhdGEpO1xyXG4gICAgICBpZihjYWxlbmRhckRhdGEpIHtcclxuICAgICAgICBldmVudHNBbGwgPSBPYmplY3QuYXNzaWduKHt9LCAgY2FsZW5kYXJEYXRhKTtcclxuXHJcbiAgICAgICAgaWYoY2FsZW5kYXJEYXRhW3NlbGYuaWRdKSB7XHJcbiAgICAgICAgICBldmVudHMgPSBjYWxlbmRhckRhdGFbc2VsZi5pZF07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcmVuZGVySGVhZCgpIHtcclxuICAgICAgdmFyIHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICAgICAgdGl0bGUuaW5uZXJUZXh0ID0gc2VsZi50aXRsZTtcclxuXHJcbiAgICAgIHZhciBsZWZ0QXJyb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgIGxlZnRBcnJvdy5jbGFzc05hbWUgPSAnYnRuLWNvbnRyb2wgYnRuLWJhY2snO1xyXG4gICAgICBsZWZ0QXJyb3cuaW5uZXJUZXh0ID0gJzwnXHJcblxyXG4gICAgICB2YXIgcmlnaHRBcnJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgcmlnaHRBcnJvdy5jbGFzc05hbWUgPSAnYnRuLWNvbnRyb2wgYnRuLWZvcndhcmQnO1xyXG4gICAgICByaWdodEFycm93LmlubmVyVGV4dCA9ICc+JztcclxuXHJcbiAgICAgIHZhciBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICBkYXRlLmNsYXNzTmFtZSA9ICdkYXRlJztcclxuICAgICAgZGF0ZS5pbm5lckhUTUwgPSBjdXJyZW50RGF0ZS5nZXRGdWxsWWVhcigpICsgJy8nICsgKGN1cnJlbnREYXRlLmdldE1vbnRoKCkgKyAxKTtcclxuXHJcbiAgICAgIHZhciBoZWFkRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgIGhlYWREaXYuY2xhc3NOYW1lID0gJ2NhbGVuZGFyLWhlYWQnO1xyXG4gICAgICBoZWFkRGl2LmFwcGVuZENoaWxkKHRpdGxlKTtcclxuXHJcbiAgICAgIHZhciByb3cyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblxyXG4gICAgICBpZihzZWxmLnNob3dDb250cm9scykge1xyXG4gICAgICAgIHJvdzIuYXBwZW5kKGxlZnRBcnJvdywgZGF0ZSwgcmlnaHRBcnJvdyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcm93Mi5hcHBlbmQoZGF0ZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGhlYWREaXYuYXBwZW5kKHJvdzIpO1xyXG4gICAgICBjYWxlbmRhckRpdi5hcHBlbmRDaGlsZChoZWFkRGl2KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBoYW5kbGVCdXR0b24oZXZlbnQpIHtcclxuICAgICAgaWYoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdFswXSAhPT0gJ2J0bi1jb250cm9sJykgcmV0dXJuO1xyXG4gICAgICB2YXIgbnVtO1xyXG4gICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0WzFdID09PSAnYnRuLWZvcndhcmQnID8gbnVtID0gMSA6IG51bSA9IC0xXHJcbiAgICAgIGN1cnJlbnREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuc2V0TW9udGgoY3VycmVudERhdGUuZ2V0TW9udGgoKSArIG51bSkpO1xyXG5cclxuICAgICAgdmFyIGRlbGV0ZTEgPSBjYWxlbmRhckRpdi5xdWVyeVNlbGVjdG9yKCd0YWJsZScpO1xyXG4gICAgICBkZWxldGUxLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZGVsZXRlMSk7XHJcbiAgICAgIHJlbmRlckNhbGVuZGFyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcmVuZGVyQ2FsZW5kYXIoKSB7XHJcblxyXG4gICAgICB2YXIgZGF0ZSA9IGNhbGVuZGFyRGl2LnF1ZXJ5U2VsZWN0b3IoJy5kYXRlJyk7XHJcbiAgICAgIGRhdGUuaW5uZXJIVE1MID0gY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKSArICcvJyArIChjdXJyZW50RGF0ZS5nZXRNb250aCgpICsgMSk7XHJcblxyXG4gICAgICB2YXIgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xyXG4gICAgICB0YWJsZS5jbGFzc05hbWUgPSAndGFibGUgdGFibGUtYm9yZGVyZWQnO1xyXG4gICAgICB0YWJsZS5pbm5lckhUTUwgPSAnPHRib2R5Pjx0cj48L3RyPjwvdGJvZHk+JztcclxuICAgICAgdmFyIHRoZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGhlYWQnKTtcclxuICAgICAgdGhlYWQuaW5uZXJIVE1MXHJcbiAgICAgIHZhciB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XHJcbiAgICAgIHZhciB0aE5hbWUgPSBbJ21vbicsICd0dWUnLCAnd2VkJywgJ3RodScsICdmcmknLCAnc2F0JywgJ3N1biddO1xyXG5cclxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aE5hbWUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB2YXIgdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpO1xyXG4gICAgICAgIHRoLmlubmVySFRNTCA9IHRoTmFtZVtpXTtcclxuICAgICAgICB0ci5hcHBlbmRDaGlsZCh0aCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoZWFkLmluc2VydEJlZm9yZSh0ciwgdGhlYWQuY2hpbGROb2Rlc1swXSk7XHJcblxyXG4gICAgICB0YWJsZS5pbnNlcnRCZWZvcmUodGhlYWQsIHRhYmxlLmNoaWxkTm9kZXNbMF0pO1xyXG5cclxuICAgICAgdmFyIGZpcnN0RGF5ID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKSwgY3VycmVudERhdGUuZ2V0TW9udGgoKSwgMSkuZ2V0RGF5KCk7XHJcbiAgICAgIGlmKGZpcnN0RGF5ID09PSAwKSBmaXJzdERheSA9IDc7XHJcblxyXG4gICAgICB2YXIgdGJvZHkgPSB0YWJsZS5xdWVyeVNlbGVjdG9yKCd0Ym9keScpO1xyXG5cclxuICAgICAgdmFyIGRheSA9IDE7XHJcbiAgICAgIHdoaWxlIChkYXkgPD0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKSwgKGN1cnJlbnREYXRlLmdldE1vbnRoKCkrMSksIDApLmdldERhdGUoKSkge1xyXG5cclxuICAgICAgICB0ciA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyJyk7XHJcblxyXG4gICAgICAgIGlmKGRheSA9PT0gMSApIHtcclxuICAgICAgICAgIGZvciAodmFyIGkgPSBkYXk7IGkgPCBmaXJzdERheTsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRyW3RyLmxlbmd0aC0xXS5pbm5lckhUTUwgKz0gJzx0ZD48L3RkPic7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgICAgIHRkLmlubmVySFRNTCA9IGRheTtcclxuICAgICAgICB0ZC5jbGFzc05hbWUgPSBTdHJpbmcoZGF5KS5sZW5ndGggPT09IDEgPyAnMCcgKyBkYXkgOiBkYXk7XHJcbiAgICAgICAgdHJbdHIubGVuZ3RoLTFdLmFwcGVuZENoaWxkKHRkKTtcclxuXHJcbiAgICAgICAgaWYodHJbdHIubGVuZ3RoLTFdLmNoaWxkRWxlbWVudENvdW50ID4gNikge1xyXG4gICAgICAgICAgdGJvZHkuaW5uZXJIVE1MICs9ICc8dHI+PC90cj4nO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGF5Kys7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNhbGVuZGFyRGl2LmFwcGVuZENoaWxkKHRhYmxlKTtcclxuXHJcbiAgICAgIHJlbmRlckV2ZW50cygpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJlbmRlckV2ZW50cygpIHtcclxuICAgICAgZm9yICh2YXIgZXZlbnREYXRlIGluIGV2ZW50cykge1xyXG4gICAgICAgIGlmKGV2ZW50RGF0ZS5zdWJzdHJpbmcoMCwgOCkgPT09IGN1cnJlbnREYXRlLnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDgpKSB7XHJcbiAgICAgICAgICB2YXIgZXZlbnREYXkgPSBjYWxlbmRhckRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGAke1N0cmluZyhldmVudERhdGUuc3Vic3RyaW5nKDgsIDEwKSl9YCk7XHJcbiAgICAgICAgICBldmVudHNbZXZlbnREYXRlXS5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIHJlbmRlckV2ZW50KGV2ZW50RGF5WzBdLCBpdGVtKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJlbmRlckV2ZW50KHdoZXJlLCB0ZXh0KSB7XHJcbiAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgZGl2LmNsYXNzTmFtZSA9ICdldmVudCAnICsgd2hlcmUuY2xhc3NOYW1lO1xyXG4gICAgICBkaXYuaW5uZXJIVE1MID0gYCR7dGV4dH08c3BhbiBjbGFzcz1cImRlbGV0ZVwiPng8L3NwYW4+YDtcclxuXHJcbiAgICAgIHdoZXJlLmFwcGVuZENoaWxkKGRpdik7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkVXNlckV2ZW50KCkge1xyXG4gICAgICBpZihldmVudC50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAndGQnKSByZXR1cm47XHJcblxyXG4gICAgICB2YXIgdGV4dCA9IHByb21wdCgnV2hhdCB3aWxsIHlvdSBkbz8nLCAnR28gZm9yIGEgd2FsaycpO1xyXG4gICAgICBpZighdGV4dCkgcmV0dXJuO1xyXG5cclxuICAgICAgcmVuZGVyRXZlbnQoZXZlbnQudGFyZ2V0LCB0ZXh0KTtcclxuICAgICAgc2F2ZUV2ZW50VG9Mb2NhbFN0b3JhZ2UoZXZlbnQsIHRleHQpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNhdmVFdmVudFRvTG9jYWxTdG9yYWdlKGV2ZW50LCB0ZXh0KSB7XHJcbiAgICAgIHZhciBzYXZlRGF0ZSA9IGN1cnJlbnREYXRlLnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDgpICsgZXZlbnQudGFyZ2V0LmNsYXNzTmFtZTtcclxuXHJcbiAgICAgIGlmIChldmVudHNbc2F2ZURhdGVdKSB7XHJcbiAgICAgICAgZXZlbnRzW3NhdmVEYXRlXS5wdXNoKHRleHQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCBhcnIgPSBbXTtcclxuICAgICAgICBhcnIucHVzaCh0ZXh0KTtcclxuICAgICAgICBldmVudHNbc2F2ZURhdGVdID0gYXJyO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBldmVudHNBbGxbc2VsZi5pZF0gPSBldmVudHM7XHJcblxyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2FsZW5kYXJEYXRhJywgSlNPTi5zdHJpbmdpZnkoZXZlbnRzQWxsKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZGVsZXRlVXNlckV2ZW50KCkge1xyXG4gICAgICBpZihldmVudC50YXJnZXQuY2xhc3NOYW1lICE9PSAnZGVsZXRlJykgcmV0dXJuO1xyXG4gICAgICBldmVudC50YXJnZXQucGFyZW50Tm9kZS5yZW1vdmUoKTtcclxuXHJcbiAgICAgIGRlbGV0ZUV2ZW50RnJvbUxvY2FsU3RvcmFnZShldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZGVsZXRlRXZlbnRGcm9tTG9jYWxTdG9yYWdlKGV2ZW50KSB7XHJcbiAgICAgIHZhciBkZWxldGVEYXRlID0gY3VycmVudERhdGUudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgOCkgKyBldmVudC50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3RbMV07XHJcbiAgICAgIHZhciB0ZXh0ID0gZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUuaW5uZXJUZXh0LnNsaWNlKDAsIC0xKTtcclxuICAgICAgdmFyIGluZGV4ID0gZXZlbnRzW2RlbGV0ZURhdGVdLmluZGV4T2YodGV4dCk7XHJcbiAgICAgIGV2ZW50c1tkZWxldGVEYXRlXS5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cclxuICAgICAgaWYgKGV2ZW50c1tkZWxldGVEYXRlXS5sZW5ndGggPT09IDApIGRlbGV0ZSBldmVudHNbZGVsZXRlRGF0ZV07XHJcblxyXG4gICAgICBldmVudHNBbGxbc2VsZi5pZF0gPSBldmVudHM7XHJcblxyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2FsZW5kYXJEYXRhJywgSlNPTi5zdHJpbmdpZnkoZXZlbnRzQWxsKSk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxufSJdfQ==

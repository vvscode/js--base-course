!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=r(e("./components/coordinates")),i=r(e("./components/favorites")),a=r(e("./components/forecast")),s=r(e("./components/history")),u=r(e("./components/map")),c=r(e("./components/search")),l=r(e("./routes/index")),f=r(e("./routes/about")),d=r(e("./utils/general")),h=r(e("./utils/router")),p=r(e("./utils/request")),v=new d.default,g=new u.default(v),m=new l.default(g),y=new f.default,b=new p.default(g,v),w=[m,y];new h.default(w,v),new c.default(b,v),new a.default(v),new o.default(b,g),new s.default(b,v),new i.default(g,b,v)},{"./components/coordinates":2,"./components/favorites":3,"./components/forecast":4,"./components/history":5,"./components/map":6,"./components/search":7,"./routes/about":9,"./routes/index":10,"./utils/general":11,"./utils/request":12,"./utils/router":13}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n){r(this,e),this.request=t,this.map=n,this.hash=window.location.hash,this.coordinates=[],this.init()}return o(e,[{key:"init",value:function(){var e=this;this.coordinates=this.hash,0===this.coordinates.indexOf("#")&&(this.coordinates=this.coordinates.slice(1)),this.coordinates.indexOf("#")>=0&&(this.coordinates=this.coordinates.split("#"),this.coordinates=this.coordinates.map(function(e){return+e}),this.map.getAPI(),setTimeout(function(){return e.request.run(e.coordinates)},3e3))}}]),e}();n.default=i},{}],3:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,o){var i=this;r(this,e),this.map=t,this.request=n,this.general=o,this.list=document.querySelector(".favorites-list"),this.favorites=document.querySelector("#favorites-id"),this.favorites.addEventListener("click",function(){return i.add("new")}),this.general.eventBus.on("favoritesObj",this.render.bind(this)),this.general.eventBus.on("map:boundschange",this.addActiveClass.bind(this))}return o(e,[{key:"add",value:function(e){var t=JSON.parse(localStorage.getItem("favoritesObj"))||{},n={};if("new"===e?n=JSON.parse(localStorage.getItem("currentForecastObj"))||{}:(n[e]=t[e]||{},console.log(JSON.stringify(n,"",4))),Object.keys(n).length>0){var r=n[Object.keys(n)[0]],o=r.latitude+"#"+r.longitude;t[o]&&delete t[o];var i=Object.assign({},n);t=Object.assign(i,t),Object.keys(t).length>5&&delete t[Object.keys(t)[5]],localStorage.setItem("favoritesObj",JSON.stringify(t,"",4)),this.general.eventBus.trigger("favoritesObj",t),this.addActiveClass()}}},{key:"render",value:function(e){var t=this;Object.keys(e).length>0?function(){console.log("%c%s%c %s","background: #333333; color: #f9ce00","favoritesObj","background: #fff; color: #000",JSON.stringify(e,"",4)),t.list.innerHTML='<p class="favorites-list-header">Избранное:</p>';for(var n in e)t.list.innerHTML+='<p title="'+e[n].description+'" class="favorites-list-item">'+e[n].description+" <span>"+e[n].temperature+"&deg;C<span></p>";for(var r=document.querySelectorAll(".favorites-list-item"),o=document.querySelector("#search-field-id"),i=0;i<r.length;i++)r[i].addEventListener("click",function(){var n=event.target.innerHTML.split(" <span>");for(var r in e)e[r].description===n[0]&&(o.value="",t.add(r),t.request.run(e[r].coordinates))})}():this.list.innerHTML=""}},{key:"addActiveClass",value:function(e){var t=JSON.parse(localStorage.getItem("favoritesObj"))||{},n=document.querySelector("#favorites-id"),r=this.map.myMap.getCenter();if(e&&e[0]===r[0]&&e[1]===r[1]){r=e.map(function(e){return+(+e).toFixed(7)});var o=!1;for(var i in t)t[i].coordinates[0]===r[0]&&t[i].coordinates[1]===r[1]&&(o=!0);o?n.classList.add("active"):n.classList.remove("active")}else if(Object.keys(t).length>0){var a=!1;r&&(r=r.map(function(e){return+(+e).toFixed(7)}));for(var s in t)t[s].coordinates[0]===r[0]&&t[s].coordinates[1]===r[1]&&(a=!0);a?n.classList.add("active"):n.classList.remove("active")}}}]),e}();n.default=i},{}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){r(this,e),this.general=t,this.general.eventBus.on("currentForecastObj",this.show)}return o(e,[{key:"show",value:function(e){var t=document.querySelector(".description"),n=document.querySelector(".forecast"),r=e[Object.keys(e)[0]],o="Нет данных";r.description?o=r.description:search.value&&(o=search.value),t.innerHTML='<p title="'+o+'">'+o+"</p>",n.innerHTML="\n\t\t <p class='degree'>"+r.temperature+"&deg;C</p><p>"+r.summary+"</p>\n\t\t <p class='coordinates'><span>lat:</span> "+r.coordinates[0]+"  <span>lng:</span> "+r.coordinates[1]+"</p>\n\t\t"}}]),e}();n.default=i},{}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n){r(this,e),this.request=t,this.general=n,this.list=document.querySelector(".forecasts-list"),this.general.eventBus.on("forecastsObj",this.render.bind(this))}return o(e,[{key:"render",value:function(e){var t=this;Object.keys(e).length>0?function(){t.list.innerHTML='<p class="forecasts-list-header">Последние просмотренные:</p>';for(var n in e)t.list.innerHTML+='<p title="'+e[n].description+'" class="forecasts-list-item">'+e[n].searchRequest+" <span>"+e[n].temperature+"&deg;C<span></p>";for(var r=document.querySelectorAll(".forecasts-list-item"),o=document.querySelector("#search-field-id"),i=0;i<r.length;i++)r[i].addEventListener("click",function(){var n=event.target.innerHTML.split(" <span>");for(var r in e)e[r].searchRequest===n[0]&&(o.value=e[r].searchRequest,t.request.run(o.value))})}():this.list.innerHTML=""}}]),e}();n.default=i},{}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(e("../utils/request")),a=function(){function e(t){r(this,e),this.general=t,this.el="#map",this.myMap={}}return o(e,[{key:"getAPI",value:function(){var e=this,t=document.createElement("script");t.src="https://api-maps.yandex.ru/2.1/?lang=ru_RU",document.head.appendChild(t);var n=function(){return e.init()};t.onload=t.onerror=function(){e.executed||(e.executed=!0,n())},t.onreadystatechange=function(){var t=e;"complete"!==e.readyState&&"loaded"!==e.readyState||setTimeout(function(){t.onload()},0)}}},{key:"init",value:function(){var e=this,t=this.el.slice(1),n=void 0,r=function(){ymaps.ready(function(){e.myMap=new ymaps.Map(t,{center:n,zoom:12,type:"yandex#hybrid",controls:["zoomControl"]}),o(),e.myMap.events.add("boundschange",function(){e.general.eventBus.trigger("map:boundschange",e.myMap.getCenter())})});var r=function(){document.querySelector("#search-field-id").value="";var t=e.myMap.getCenter();t&&(t=t.map(function(e){return+e.toFixed(7)}),new i.default(e,e.general).run(t))},o=function(){var t=e.general.debounce(r,1300);e.myMap.events.add("mousedown",function(){e.general.eventBus.trigger("map:mousedown",t())}),e.myMap.events.add("wheel",function(){e.general.eventBus.trigger("map:wheel",t())})}};window.location.hash?(0===(n=window.location.hash).indexOf("#")&&(n=n.slice(1)),n=n.split("#"),n=n.map(function(e){return+e}),r()):fetch("https://api.userinfo.io/userinfos").then(function(e){return e.json()}).then(function(e){return[e.position.latitude,e.position.longitude]}).then(function(e){n=e,r()}).catch(function(e){return console.error(e)})}},{key:"render",value:function(e){this.myMap.setCenter(e)}}]),e}();n.default=a},{"../utils/request":12}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n){r(this,e),this.search=document.querySelector("#search-field-id"),this.request=t,this.general=n,this.init()}return o(e,[{key:"init",value:function(){var e=this,t=this.general.debounce(this.sendRequest.bind(this),1300);this.search.addEventListener("input",function(){e.general.eventBus.trigger("search:request",t())}),this.search.addEventListener("keypress",function(t){13===(t.which||t.keyCode)&&(t.preventDefault(),e.general.eventBus.trigger("search:request",e.sendRequest.bind(e)))})}},{key:"sendRequest",value:function(){this.search.value&&this.search.value.length>3&&this.request.run(this.search.value)}}]),e}();n.default=i},{}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){r(this,e),this.el=t,this.setDefault()}return o(e,[{key:"setDefault",value:function(){document.querySelector(this.el).checked=!0}},{key:"check",value:function(){return document.querySelector(this.el).checked}}]),e}();n.default=i},{}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){r(this,e),this.name="about",this.match="about"}return o(e,[{key:"onEnter",value:function(){var e=document.querySelector(".wrapper .container .main .about");e.classList.remove("hidden"),e.innerHTML='\n\t\t\t<p style="padding-top:250px;">© 2017 Forecast v2.3.1</p>\n\t\t',document.querySelector(".wrapper .container .main .favorites").classList.add("hidden"),document.querySelector(".wrapper .container .main .main-menu #about-id").classList.add("selected")}},{key:"onLeave",value:function(){document.querySelector(".wrapper .container .main .about").classList.add("hidden"),document.querySelector(".wrapper .container .main .favorites").classList.remove("hidden"),document.querySelector(".wrapper .container .main .main-menu #about-id").classList.remove("selected")}}]),e}();n.default=i},{}],10:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){r(this,e),this.name="index",this.match="",this.map=t,this.status=!1}return o(e,[{key:"onBeforeEnter",value:function(){this.status||(this.status=!0,this.map.getAPI())}},{key:"onEnter",value:function(){document.querySelector(".wrapper .container .main .map").classList.remove("hidden"),document.querySelector(".wrapper .container .main .main-menu #index-id").classList.add("selected")}},{key:"onLeave",value:function(){document.querySelector(".wrapper .container .main .map").classList.add("hidden"),document.querySelector(".wrapper .container .main .main-menu #index-id").classList.remove("selected")}}]),e}();n.default=i},{}],11:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){r(this,e),this.name="general",this.methodList=["eventBus","debounce","storage"],this.eventBus={listeners:{},on:function(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)},off:function(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e]=this.listeners[e].filter(function(e){return e!==t})},once:function(e,t){var n=this;this.on(e,function r(o){t(o),n.off(e,r)})},trigger:function(e,t){(this.listeners[e]||[]).forEach(function(e){return e(t)})}},this.eventBus.on("request:data",this.storage.bind(this)),localStorage.clear()}return o(e,[{key:"debounce",value:function(e,t){var n=arguments,r=void 0;return function(){clearTimeout(r);var o=n;r=setTimeout(function(){e.apply(null,o)},t)}}},{key:"storage",value:function(e){var t=this,n=document.querySelector("#search-field-id"),r=JSON.parse(localStorage.getItem("forecastsObj"))||{},o={},i=e.latitude+"#"+e.longitude;o[i]={searchRequest:null,description:"",summary:e.currently.summary,temperature:e.currently.temperature.toFixed(0),coordinates:[e.latitude,e.longitude]};var a=function(){if(n.value){o[i].searchRequest=n.value,localStorage.setItem("currentForecastObj",JSON.stringify(o,"",4)),console.log(""),console.log("%c%s%c %s","background: #333333; color: #81e56c","currentForecastObj","background: #fff; color: #000",JSON.stringify(o,"",4)),r[i]&&delete r[i];var e=Object.assign({},o);r=Object.assign(e,r),Object.keys(r).length>5&&delete r[Object.keys(r)[5]],localStorage.setItem("forecastsObj",JSON.stringify(r,"",4))}else localStorage.setItem("currentForecastObj",JSON.stringify(o,"",4)),console.log(""),console.log("%c%s%c %s","background: #333333; color: #81e56c","currentForecastObj","background: #fff; color: #000",JSON.stringify(o,"",4));Object.keys(r).length>0&&console.log("%c%s%c %s","background: #333333; color: #e1e7a2","forecastsObj","background: #fff; color: #000",JSON.stringify(r,"",4)),console.log("__________________________________________________"),t.eventBus.trigger("currentForecastObj",o),t.eventBus.trigger("forecastsObj",r)};ymaps.geocode([e.latitude,e.longitude].join(","),{json:!0,results:1}).then(function(e){var t=e.GeoObjectCollection.featureMember,n=t&&t.length?t[0].GeoObject:null;n&&(o[i].description=n.metaDataProperty.GeocoderMetaData.text,a())})}},{key:"getHistory",value:function(){}}]),e}();n.default=i},{}],12:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=new(function(e){return e&&e.__esModule?e:{default:e}}(e("../components/switcher")).default)("#fetch-id"),a=function(){function e(t,n){r(this,e),this.map=t,this.general=n,this.coordinates=[]}return o(e,[{key:"run",value:function(e){var t=this;this.value=e,this.requestType=i.check()?(t.fetch(),"Fetch"):(t.xhr(),"XHR")}},{key:"trigger",value:function(e){this.general.eventBus.trigger("request:data",e)}},{key:"setCenter",value:function(e,t){this.map.render([e,t])}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;console.log("Fetch request");var t=function(t){window.location.hash=t[0]+"#"+t[1],2===t.length?fetch("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/02c1428da75f9c5927065135c43bca6b/"+t[0]+","+t[1]+"?lang=ru&units=si").then(function(e){return e.json()}).then(function(t){e.setCenter(t.latitude,t.longitude),e.trigger(t)}).catch(function(e){return console.error(e)}):(e.getErrorText(),console.error("Warning! coordinates array has wrong length!"))};this.value instanceof Array?(this.coordinates=this.value,t(this.coordinates)):fetch("https://maps.googleapis.com/maps/api/geocode/json?address="+this.value+"&key=AIzaSyAixr2nI5GQlenIgblTO8uMGCduUwWS70o").then(function(e){return e.json()}).then(function(n){e.coordinates=[n.results[0].geometry.location.lat,n.results[0].geometry.location.lng],e.coordinates=e.coordinates.map(function(e){return+e.toFixed(7)}),t(e.coordinates)}).catch(function(t){e.getErrorText(),console.error(t)})})},{key:"xhr",value:function(){var e=this;console.log("XHR request");var t=this,n=function(e){window.location.hash=e[0]+"#"+e[1],new Promise(function(n,r){var o=new XMLHttpRequest;o.open("GET","https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/02c1428da75f9c5927065135c43bca6b/"+e[0]+","+e[1]+"?lang=ru&units=si",!0),o.onload=function(){if(200===this.status){var e=JSON.parse(this.response);t.setCenter(e.latitude,e.longitude),t.trigger(e),n(e)}else{var o=new Error(this.statusText);o.code=this.status,r(o)}},o.onerror=function(){r(new Error("Something gone wrong"))},o.send()})};this.value instanceof Array?(this.coordinates=this.value,n(this.coordinates)):new Promise(function(r,o){var i=new XMLHttpRequest;i.open("GET","https://maps.googleapis.com/maps/api/geocode/json?address="+e.value+"&key=AIzaSyAixr2nI5GQlenIgblTO8uMGCduUwWS70o",!0),i.onload=function(){if(200===this.status){var e=JSON.parse(this.response);e&&e.results&&e.results[0]?(this.coordinates=[e.results[0].geometry.location.lat,e.results[0].geometry.location.lng],this.coordinates=this.coordinates.map(function(e){return+e.toFixed(7)}),n(this.coordinates)):(t.getErrorText(),console.error("There is no coordinates in data.results"))}else{t.getErrorText();var r=new Error(this.statusText);r.code=this.status,o(r)}},i.onerror=function(){t.getErrorText(),o(new Error("Something gone wrong"))},i.send()})}},{key:"getErrorText",value:function(){var e=document.querySelector(".description"),t=document.querySelector(".forecast");e.innerHTML='<p class="error">Неправильные параметры поиска</p>',t.innerHTML=""}}]),e}();n.default=a},{"../components/switcher":8}],13:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n){r(this,e),this.routes=t||[],this.general=n,this.init()}return o(e,[{key:"init",value:function(){var e=this;window.addEventListener("hashchange",function(){return e.handleUrl(window.location.hash)}),this.handleUrl(window.location.hash)}},{key:"findPreviousActiveRoute",value:function(){return this.currentRoute}},{key:"findNewActiveRoute",value:function(e){var t=this.routes.find(function(t){return"string"==typeof t.match?e===t.match:"function"==typeof t.match?t.match(e):t.match instanceof RegExp?e.match(t.match):void 0});return t||(t=this.routes[0]),t}},{key:"handleUrl",value:function(e){var t=this;e=e.slice(1);var n=this.findPreviousActiveRoute(),r=this.findNewActiveRoute(e);Promise.resolve().then(function(){return n&&n.onLeave&&n.onLeave(window.location.hash,t.general.eventBus)}).then(function(){return r&&r.onBeforeEnter&&r.onBeforeEnter(window.location.hash,t.general.eventBus)}).then(function(){return r&&r.onEnter&&r.onEnter(window.location.hash,t.general.eventBus)}).then(function(){t.currentRoute=r})}}]),e}();n.default=i},{}]},{},[1]);